9de43b86f8b12fd5b07a775febbfd285
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('app/core/auth/account.service');
const core_1 = require("@angular/core");
const testing_1 = require("@angular/core/testing");
const platform_browser_1 = require("@angular/platform-browser");
const rxjs_1 = require("rxjs");
const account_service_1 = require("app/core/auth/account.service");
const has_any_authority_directive_1 = require("./has-any-authority.directive");
let TestHasAnyAuthorityDirectiveComponent = class TestHasAnyAuthorityDirectiveComponent {
};
TestHasAnyAuthorityDirectiveComponent.propDecorators = {
    content: [{ type: core_1.ViewChild, args: ['content', { static: false },] }]
};
TestHasAnyAuthorityDirectiveComponent = tslib_1.__decorate([
    core_1.Component({
        template: ` <div *jhiHasAnyAuthority="'ROLE_ADMIN'" #content></div> `,
    })
], TestHasAnyAuthorityDirectiveComponent);
describe('HasAnyAuthorityDirective tests', () => {
    let mockAccountService;
    const authenticationState = new rxjs_1.Subject();
    beforeEach(testing_1.waitForAsync(() => {
        testing_1.TestBed.configureTestingModule({
            declarations: [has_any_authority_directive_1.HasAnyAuthorityDirective, TestHasAnyAuthorityDirectiveComponent],
            providers: [account_service_1.AccountService],
        });
    }));
    beforeEach(() => {
        mockAccountService = testing_1.TestBed.inject(account_service_1.AccountService);
        mockAccountService.getAuthenticationState = jest.fn(() => authenticationState.asObservable());
    });
    describe('set jhiHasAnyAuthority', () => {
        it('should show restricted content to user if user has required role', () => {
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => true);
            const fixture = testing_1.TestBed.createComponent(TestHasAnyAuthorityDirectiveComponent);
            const comp = fixture.componentInstance;
            // WHEN
            fixture.detectChanges();
            // THEN
            expect(comp.content).toBeDefined();
        });
        it('should not show restricted content to user if user has not required role', () => {
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => false);
            const fixture = testing_1.TestBed.createComponent(TestHasAnyAuthorityDirectiveComponent);
            const comp = fixture.componentInstance;
            // WHEN
            fixture.detectChanges();
            // THEN
            expect(comp.content).toBeUndefined();
        });
    });
    describe('change authorities', () => {
        it('should show or not show restricted content correctly if user authorities are changing', () => {
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => true);
            const fixture = testing_1.TestBed.createComponent(TestHasAnyAuthorityDirectiveComponent);
            const comp = fixture.componentInstance;
            // WHEN
            fixture.detectChanges();
            // THEN
            expect(comp.content).toBeDefined();
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => false);
            // WHEN
            authenticationState.next();
            fixture.detectChanges();
            // THEN
            expect(comp.content).toBeUndefined();
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => true);
            // WHEN
            authenticationState.next();
            fixture.detectChanges();
            // THEN
            expect(comp.content).toBeDefined();
        });
    });
    describe('ngOnDestroy', () => {
        it('should destroy authentication state subscription on component destroy', () => {
            // GIVEN
            mockAccountService.hasAnyAuthority = jest.fn(() => true);
            const fixture = testing_1.TestBed.createComponent(TestHasAnyAuthorityDirectiveComponent);
            const div = fixture.debugElement.queryAllNodes(platform_browser_1.By.directive(has_any_authority_directive_1.HasAnyAuthorityDirective))[0];
            const hasAnyAuthorityDirective = div.injector.get(has_any_authority_directive_1.HasAnyAuthorityDirective);
            // WHEN
            fixture.detectChanges();
            // THEN
            expect(mockAccountService.hasAnyAuthority).toHaveBeenCalled();
            // WHEN
            jest.clearAllMocks();
            authenticationState.next();
            // THEN
            expect(mockAccountService.hasAnyAuthority).toHaveBeenCalled();
            // WHEN
            jest.clearAllMocks();
            hasAnyAuthorityDirective.ngOnDestroy();
            authenticationState.next();
            // THEN
            expect(mockAccountService.hasAnyAuthority).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2FraGlsc2luZ2gvRGVza3RvcC9Qcm9qZWN0cy93ZWRkaW5nL3NyYy9tYWluL3dlYmFwcC9hcHAvc2hhcmVkL2F1dGgvaGFzLWFueS1hdXRob3JpdHkuZGlyZWN0aXZlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBRTNDLHdDQUFpRTtBQUNqRSxtREFBOEQ7QUFDOUQsZ0VBQStDO0FBQy9DLCtCQUErQjtBQUUvQixtRUFBK0Q7QUFHL0QsK0VBQXlFO0lBS25FLHFDQUFxQyxTQUFyQyxxQ0FBcUM7Q0FHMUMsQ0FBQTs7c0JBRkUsZ0JBQVMsU0FBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOztBQURuQyxxQ0FBcUM7SUFIMUMsZ0JBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSwyREFBMkQ7S0FDdEUsQ0FBQztHQUNJLHFDQUFxQyxDQUcxQztBQUVELFFBQVEsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7SUFDOUMsSUFBSSxrQkFBa0MsQ0FBQztJQUN2QyxNQUFNLG1CQUFtQixHQUFHLElBQUksY0FBTyxFQUFrQixDQUFDO0lBRTFELFVBQVUsQ0FDUixzQkFBWSxDQUFDLEdBQUcsRUFBRTtRQUNoQixpQkFBTyxDQUFDLHNCQUFzQixDQUFDO1lBQzdCLFlBQVksRUFBRSxDQUFDLHNEQUF3QixFQUFFLHFDQUFxQyxDQUFDO1lBQy9FLFNBQVMsRUFBRSxDQUFDLGdDQUFjLENBQUM7U0FDNUIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUVGLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxrQkFBa0IsR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxnQ0FBYyxDQUFDLENBQUM7UUFDcEQsa0JBQWtCLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBQ2hHLENB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LENBQUMsQ0FBQztZQUN6RCxNQUFNLE9BQU8sR0FBRyxpQkFBTyxDQUFDLGVBQWUsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1lBQy9FLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLHFCQUFFLENBQUMsU0FBUyxDQUFDLHNEQUF3QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRixNQUFNLHdCQUF3QixHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHNEQUF3QixDQUFDLENBQUM7WUFFNUUsT0FBTztZQUNQLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUV4QixPQUFPO1lBQ1AsTUFBTSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFOUQsT0FBTztZQUNQLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQixtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUUzQixPQUFPO1lBQ1AsTUFBTSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFOUQsT0FBTztZQUNQLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQix3QkFBd0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUUzQixPQUFPO1lBQ1AsTUFBTSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvYWtoaWxzaW5naC9EZXNrdG9wL1Byb2plY3RzL3dlZGRpbmcvc3JjL21haW4vd2ViYXBwL2FwcC9zaGFyZWQvYXV0aC9oYXMtYW55LWF1dGhvcml0eS5kaXJlY3RpdmUuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJqZXN0Lm1vY2soJ2FwcC9jb3JlL2F1dGgvYWNjb3VudC5zZXJ2aWNlJyk7XG5cbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUZXN0QmVkLCB3YWl0Rm9yQXN5bmMgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQnkgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgQWNjb3VudFNlcnZpY2UgfSBmcm9tICdhcHAvY29yZS9hdXRoL2FjY291bnQuc2VydmljZSc7XG5pbXBvcnQgeyBBY2NvdW50IH0gZnJvbSAnYXBwL2NvcmUvYXV0aC9hY2NvdW50Lm1vZGVsJztcblxuaW1wb3J0IHsgSGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlIH0gZnJvbSAnLi9oYXMtYW55LWF1dGhvcml0eS5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgdGVtcGxhdGU6IGAgPGRpdiAqamhpSGFzQW55QXV0aG9yaXR5PVwiJ1JPTEVfQURNSU4nXCIgI2NvbnRlbnQ+PC9kaXY+IGAsXG59KVxuY2xhc3MgVGVzdEhhc0FueUF1dGhvcml0eURpcmVjdGl2ZUNvbXBvbmVudCB7XG4gIEBWaWV3Q2hpbGQoJ2NvbnRlbnQnLCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgY29udGVudD86IEVsZW1lbnRSZWY7XG59XG5cbmRlc2NyaWJlKCdIYXNBbnlBdXRob3JpdHlEaXJlY3RpdmUgdGVzdHMnLCAoKSA9PiB7XG4gIGxldCBtb2NrQWNjb3VudFNlcnZpY2U6IEFjY291bnRTZXJ2aWNlO1xuICBjb25zdCBhdXRoZW50aWNhdGlvblN0YXRlID0gbmV3IFN1YmplY3Q8QWNjb3VudCB8IG51bGw+KCk7XG5cbiAgYmVmb3JlRWFjaChcbiAgICB3YWl0Rm9yQXN5bmMoKCkgPT4ge1xuICAgICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAgICAgICAgZGVjbGFyYXRpb25zOiBbSGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlLCBUZXN0SGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlQ29tcG9uZW50XSxcbiAgICAgICAgcHJvdmlkZXJzOiBbQWNjb3VudFNlcnZpY2VdLFxuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrQWNjb3VudFNlcnZpY2UgPSBUZXN0QmVkLmluamVjdChBY2NvdW50U2VydmljZSk7XG4gICAgbW9ja0FjY291bnRTZXJ2aWNlLmdldEF1dGhlbnRpY2F0aW9uU3RhdGUgPSBqZXN0LmZuKCgpID0+IGF1dGhlbnRpY2F0aW9uU3RhdGUuYXNPYnNlcnZhYmxlKCkpO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0IGpoaUhhc0FueUF1dGhvcml0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNob3cgcmVzdHJpY3RlZCBjb250ZW50IHRvIHVzZXIgaWYgdXNlciBoYXMgcmVxdWlyZWQgcm9sZScsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBtb2NrQWNjb3VudFNlcnZpY2UuaGFzQW55QXV0aG9yaXR5ID0gamVzdC5mbigoKSA9PiB0cnVlKTtcbiAgICAgIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChUZXN0SGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlQ29tcG9uZW50KTtcbiAgICAgIGNvbnN0IGNvbXAgPSBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGNvbXAuY29udGVudCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHNob3cgcmVzdHJpY3RlZCBjb250ZW50IHRvIHVzZXIgaWYgdXNlciBoYXMgbm90IHJlcXVpcmVkIHJvbGUnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgbW9ja0FjY291bnRTZXJ2aWNlLmhhc0FueUF1dGhvcml0eSA9IGplc3QuZm4oKCkgPT4gZmFsc2UpO1xuICAgICAgY29uc3QgZml4dHVyZSA9IFRlc3RCZWQuY3JlYXRlQ29tcG9uZW50KFRlc3RIYXNBbnlBdXRob3JpdHlEaXJlY3RpdmVDb21wb25lbnQpO1xuICAgICAgY29uc3QgY29tcCA9IGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2U7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoY29tcC5jb250ZW50KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGFuZ2UgYXV0aG9yaXRpZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzaG93IG9yIG5vdCBzaG93IHJlc3RyaWN0ZWQgY29udGVudCBjb3JyZWN0bHkgaWYgdXNlciBhdXRob3JpdGllcyBhcmUgY2hhbmdpbmcnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgbW9ja0FjY291bnRTZXJ2aWNlLmhhc0FueUF1dGhvcml0eSA9IGplc3QuZm4oKCkgPT4gdHJ1ZSk7XG4gICAgICBjb25zdCBmaXh0dXJlID0gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoVGVzdEhhc0FueUF1dGhvcml0eURpcmVjdGl2ZUNvbXBvbmVudCk7XG4gICAgICBjb25zdCBjb21wID0gZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChjb21wLmNvbnRlbnQpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIEdJVkVOXG4gICAgICBtb2NrQWNjb3VudFNlcnZpY2UuaGFzQW55QXV0aG9yaXR5ID0gamVzdC5mbigoKSA9PiBmYWxzZSk7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGF1dGhlbnRpY2F0aW9uU3RhdGUubmV4dCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChjb21wLmNvbnRlbnQpLnRvQmVVbmRlZmluZWQoKTtcblxuICAgICAgLy8gR0lWRU5cbiAgICAgIG1vY2tBY2NvdW50U2VydmljZS5oYXNBbnlBdXRob3JpdHkgPSBqZXN0LmZuKCgpID0+IHRydWUpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBhdXRoZW50aWNhdGlvblN0YXRlLm5leHQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoY29tcC5jb250ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbmdPbkRlc3Ryb3knLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXN0cm95IGF1dGhlbnRpY2F0aW9uIHN0YXRlIHN1YnNjcmlwdGlvbiBvbiBjb21wb25lbnQgZGVzdHJveScsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBtb2NrQWNjb3VudFNlcnZpY2UuaGFzQW55QXV0aG9yaXR5ID0gamVzdC5mbigoKSA9PiB0cnVlKTtcbiAgICAgIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChUZXN0SGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlQ29tcG9uZW50KTtcbiAgICAgIGNvbnN0IGRpdiA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5QWxsTm9kZXMoQnkuZGlyZWN0aXZlKEhhc0FueUF1dGhvcml0eURpcmVjdGl2ZSkpWzBdO1xuICAgICAgY29uc3QgaGFzQW55QXV0aG9yaXR5RGlyZWN0aXZlID0gZGl2LmluamVjdG9yLmdldChIYXNBbnlBdXRob3JpdHlEaXJlY3RpdmUpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KG1vY2tBY2NvdW50U2VydmljZS5oYXNBbnlBdXRob3JpdHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICBhdXRoZW50aWNhdGlvblN0YXRlLm5leHQoKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KG1vY2tBY2NvdW50U2VydmljZS5oYXNBbnlBdXRob3JpdHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICBoYXNBbnlBdXRob3JpdHlEaXJlY3RpdmUubmdPbkRlc3Ryb3koKTtcbiAgICAgIGF1dGhlbnRpY2F0aW9uU3RhdGUubmV4dCgpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QobW9ja0FjY291bnRTZXJ2aWNlLmhhc0FueUF1dGhvcml0eSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==